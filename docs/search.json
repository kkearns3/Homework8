[
  {
    "objectID": "HW8.html",
    "href": "HW8.html",
    "title": "Homework8",
    "section": "",
    "text": "Libraries\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(tidymodels)\n\nWarning: package 'tidymodels' was built under R version 4.4.2\n\n\n── Attaching packages ────────────────────────────────────── tidymodels 1.2.0 ──\n✔ broom        1.0.7     ✔ rsample      1.2.1\n✔ dials        1.3.0     ✔ tune         1.2.1\n✔ infer        1.0.7     ✔ workflows    1.1.4\n✔ modeldata    1.4.0     ✔ workflowsets 1.1.0\n✔ parsnip      1.2.1     ✔ yardstick    1.3.1\n✔ recipes      1.1.0     \n\n\nWarning: package 'dials' was built under R version 4.4.2\n\n\nWarning: package 'infer' was built under R version 4.4.2\n\n\nWarning: package 'modeldata' was built under R version 4.4.2\n\n\nWarning: package 'parsnip' was built under R version 4.4.2\n\n\nWarning: package 'recipes' was built under R version 4.4.2\n\n\nWarning: package 'rsample' was built under R version 4.4.2\n\n\nWarning: package 'tune' was built under R version 4.4.2\n\n\nWarning: package 'workflows' was built under R version 4.4.2\n\n\nWarning: package 'workflowsets' was built under R version 4.4.2\n\n\nWarning: package 'yardstick' was built under R version 4.4.2\n\n\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ scales::discard() masks purrr::discard()\n✖ dplyr::filter()   masks stats::filter()\n✖ recipes::fixed()  masks stringr::fixed()\n✖ dplyr::lag()      masks stats::lag()\n✖ yardstick::spec() masks readr::spec()\n✖ recipes::step()   masks stats::step()\n• Dig deeper into tidy modeling with R at https://www.tmwr.org"
  },
  {
    "objectID": "HW8.html#reading-data",
    "href": "HW8.html#reading-data",
    "title": "Homework8",
    "section": "Reading Data",
    "text": "Reading Data\nRead in the data from URL, using a solution from a Stack Overflow post to fix the initial error.\n\nbike_data &lt;- read_csv(\"https://www4.stat.ncsu.edu/~online/datasets/SeoulBikeData.csv\",\n                     locale = locale(encoding=\"latin1\"))\n\nRows: 8760 Columns: 14\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (4): Date, Seasons, Holiday, Functioning Day\ndbl (10): Rented Bike Count, Hour, Temperature(°C), Humidity(%), Wind speed ...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nbike_data\n\n# A tibble: 8,760 × 14\n   Date       `Rented Bike Count`  Hour `Temperature(°C)` `Humidity(%)`\n   &lt;chr&gt;                    &lt;dbl&gt; &lt;dbl&gt;             &lt;dbl&gt;         &lt;dbl&gt;\n 1 01/12/2017                 254     0              -5.2            37\n 2 01/12/2017                 204     1              -5.5            38\n 3 01/12/2017                 173     2              -6              39\n 4 01/12/2017                 107     3              -6.2            40\n 5 01/12/2017                  78     4              -6              36\n 6 01/12/2017                 100     5              -6.4            37\n 7 01/12/2017                 181     6              -6.6            35\n 8 01/12/2017                 460     7              -7.4            38\n 9 01/12/2017                 930     8              -7.6            37\n10 01/12/2017                 490     9              -6.5            27\n# ℹ 8,750 more rows\n# ℹ 9 more variables: `Wind speed (m/s)` &lt;dbl&gt;, `Visibility (10m)` &lt;dbl&gt;,\n#   `Dew point temperature(°C)` &lt;dbl&gt;, `Solar Radiation (MJ/m2)` &lt;dbl&gt;,\n#   `Rainfall(mm)` &lt;dbl&gt;, `Snowfall (cm)` &lt;dbl&gt;, Seasons &lt;chr&gt;, Holiday &lt;chr&gt;,\n#   `Functioning Day` &lt;chr&gt;\n\n\nRename all columns to make them easier to work with\n\nnames(bike_data) &lt;- c(\"date\", \"rented_bike_count\", \"hour\", \"temperature\", \"humidity\",\n                      \"wind_speed\", \"visibility\", \"dew_point\", \"solar_radiation\",\n                      \"rainfall\", \"snowfall\", \"seasons\", \"holiday\", \"functioning_day\")"
  },
  {
    "objectID": "HW8.html#basic-eda",
    "href": "HW8.html#basic-eda",
    "title": "Homework8",
    "section": "Basic EDA",
    "text": "Basic EDA\nLook at structure, see if there are columns that are an unexpected data type based on the values\n\ndate is char, should be changed to date\nhumidity values are stored in a way that makes sense for display (e.g. 37 for 37%), but would need to be divided by 100 if used for computations (unless the computation only involves itself as a variable, e.g. taking the average humidity level)\nseasons, holiday, and functioning_day are character variables that need to be recast as factors\nall other variables are numeric, as expected\n\n\nstr(bike_data)\n\nspc_tbl_ [8,760 × 14] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ date             : chr [1:8760] \"01/12/2017\" \"01/12/2017\" \"01/12/2017\" \"01/12/2017\" ...\n $ rented_bike_count: num [1:8760] 254 204 173 107 78 100 181 460 930 490 ...\n $ hour             : num [1:8760] 0 1 2 3 4 5 6 7 8 9 ...\n $ temperature      : num [1:8760] -5.2 -5.5 -6 -6.2 -6 -6.4 -6.6 -7.4 -7.6 -6.5 ...\n $ humidity         : num [1:8760] 37 38 39 40 36 37 35 38 37 27 ...\n $ wind_speed       : num [1:8760] 2.2 0.8 1 0.9 2.3 1.5 1.3 0.9 1.1 0.5 ...\n $ visibility       : num [1:8760] 2000 2000 2000 2000 2000 ...\n $ dew_point        : num [1:8760] -17.6 -17.6 -17.7 -17.6 -18.6 -18.7 -19.5 -19.3 -19.8 -22.4 ...\n $ solar_radiation  : num [1:8760] 0 0 0 0 0 0 0 0 0.01 0.23 ...\n $ rainfall         : num [1:8760] 0 0 0 0 0 0 0 0 0 0 ...\n $ snowfall         : num [1:8760] 0 0 0 0 0 0 0 0 0 0 ...\n $ seasons          : chr [1:8760] \"Winter\" \"Winter\" \"Winter\" \"Winter\" ...\n $ holiday          : chr [1:8760] \"No Holiday\" \"No Holiday\" \"No Holiday\" \"No Holiday\" ...\n $ functioning_day  : chr [1:8760] \"Yes\" \"Yes\" \"Yes\" \"Yes\" ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   Date = col_character(),\n  ..   `Rented Bike Count` = col_double(),\n  ..   Hour = col_double(),\n  ..   `Temperature(°C)` = col_double(),\n  ..   `Humidity(%)` = col_double(),\n  ..   `Wind speed (m/s)` = col_double(),\n  ..   `Visibility (10m)` = col_double(),\n  ..   `Dew point temperature(°C)` = col_double(),\n  ..   `Solar Radiation (MJ/m2)` = col_double(),\n  ..   `Rainfall(mm)` = col_double(),\n  ..   `Snowfall (cm)` = col_double(),\n  ..   Seasons = col_character(),\n  ..   Holiday = col_character(),\n  ..   `Functioning Day` = col_character()\n  .. )\n - attr(*, \"problems\")=&lt;externalptr&gt; \n\n\nRecast date - format appears to be dd/mm/yyyy, due to the presence of strings like “15/03/2018”\n\nbike_data &lt;- bike_data |&gt;\n  mutate(date = dmy(date))\n\ncheck the min and max dates in each season to see the order the seasons should be in when that column is recast as factor\n\nbike_data |&gt;\n  group_by(seasons) |&gt;\n  summarize(min_date = min(date),\n            max_date = max(date)) |&gt;\n  arrange(min_date)\n\n# A tibble: 4 × 3\n  seasons min_date   max_date  \n  &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;    \n1 Winter  2017-12-01 2018-02-28\n2 Spring  2018-03-01 2018-05-31\n3 Summer  2018-06-01 2018-08-31\n4 Autumn  2018-09-01 2018-11-30\n\n\nConvert char columns to factors\n\nbike_data &lt;- bike_data |&gt;\n  mutate(seasons = factor(seasons,\n                          levels = c(\"Winter\", \"Spring\", \"Summer\", \"Autumn\")),\n         holiday = as.factor(holiday),\n         functioning_day = as.factor(functioning_day))\n\nbike_data\n\n# A tibble: 8,760 × 14\n   date       rented_bike_count  hour temperature humidity wind_speed visibility\n   &lt;date&gt;                 &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n 1 2017-12-01               254     0        -5.2       37        2.2       2000\n 2 2017-12-01               204     1        -5.5       38        0.8       2000\n 3 2017-12-01               173     2        -6         39        1         2000\n 4 2017-12-01               107     3        -6.2       40        0.9       2000\n 5 2017-12-01                78     4        -6         36        2.3       2000\n 6 2017-12-01               100     5        -6.4       37        1.5       2000\n 7 2017-12-01               181     6        -6.6       35        1.3       2000\n 8 2017-12-01               460     7        -7.4       38        0.9       2000\n 9 2017-12-01               930     8        -7.6       37        1.1       2000\n10 2017-12-01               490     9        -6.5       27        0.5       1928\n# ℹ 8,750 more rows\n# ℹ 7 more variables: dew_point &lt;dbl&gt;, solar_radiation &lt;dbl&gt;, rainfall &lt;dbl&gt;,\n#   snowfall &lt;dbl&gt;, seasons &lt;fct&gt;, holiday &lt;fct&gt;, functioning_day &lt;fct&gt;\n\n\nCheck for missing values\n\ncolSums(is.na(bike_data))\n\n             date rented_bike_count              hour       temperature \n                0                 0                 0                 0 \n         humidity        wind_speed        visibility         dew_point \n                0                 0                 0                 0 \n  solar_radiation          rainfall          snowfall           seasons \n                0                 0                 0                 0 \n          holiday   functioning_day \n                0                 0 \n\n\nBasic summaries for numeric columns\n\npsych::describe(bike_data)\n\nWarning in FUN(newX[, i], ...): no non-missing arguments to min; returning Inf\n\n\nWarning in FUN(newX[, i], ...): no non-missing arguments to max; returning -Inf\n\n\n                  vars    n    mean     sd  median trimmed    mad   min     max\ndate                 1 8760     NaN     NA      NA     NaN     NA   Inf    -Inf\nrented_bike_count    2 8760  704.60 645.00  504.50  612.58 553.75   0.0 3556.00\nhour                 3 8760   11.50   6.92   11.50   11.50   8.90   0.0   23.00\ntemperature          4 8760   12.88  11.94   13.70   13.19  13.94 -17.8   39.40\nhumidity             5 8760   58.23  20.36   57.00   58.02  23.72   0.0   98.00\nwind_speed           6 8760    1.72   1.04    1.50    1.63   1.04   0.0    7.40\nvisibility           7 8760 1436.83 608.30 1698.00 1509.50 447.75  27.0 2000.00\ndew_point            8 8760    4.07  13.06    5.10    4.76  14.38 -30.6   27.20\nsolar_radiation      9 8760    0.57   0.87    0.01    0.38   0.01   0.0    3.52\nrainfall            10 8760    0.15   1.13    0.00    0.00   0.00   0.0   35.00\nsnowfall            11 8760    0.08   0.44    0.00    0.00   0.00   0.0    8.80\nseasons*            12 8760    2.50   1.11    3.00    2.51   1.48   1.0    4.00\nholiday*            13 8760    1.95   0.22    2.00    2.00   0.00   1.0    2.00\nfunctioning_day*    14 8760    1.97   0.18    2.00    2.00   0.00   1.0    2.00\n                    range  skew kurtosis   se\ndate                 -Inf    NA       NA   NA\nrented_bike_count 3556.00  1.15     0.85 6.89\nhour                23.00  0.00    -1.20 0.07\ntemperature         57.20 -0.20    -0.84 0.13\nhumidity            98.00  0.06    -0.80 0.22\nwind_speed           7.40  0.89     0.73 0.01\nvisibility        1973.00 -0.70    -0.96 6.50\ndew_point           57.80 -0.37    -0.76 0.14\nsolar_radiation      3.52  1.50     1.12 0.01\nrainfall            35.00 14.53   284.76 0.01\nsnowfall             8.80  8.44    93.73 0.00\nseasons*             3.00  0.00    -1.35 0.01\nholiday*             1.00 -4.16    15.33 0.00\nfunctioning_day*     1.00 -5.17    24.72 0.00\n\n\nLook at distinct values for the rest of the categorical variables (already did seasons above)\n\nbike_data |&gt;\n  group_by(holiday) |&gt;\n  summarize(count = n())\n\n# A tibble: 2 × 2\n  holiday    count\n  &lt;fct&gt;      &lt;int&gt;\n1 Holiday      432\n2 No Holiday  8328\n\n\n\nbike_data |&gt;\n  group_by(functioning_day) |&gt;\n  summarize(count = n(),\n            total_bikes = sum(rented_bike_count))\n\n# A tibble: 2 × 3\n  functioning_day count total_bikes\n  &lt;fct&gt;           &lt;int&gt;       &lt;dbl&gt;\n1 No                295           0\n2 Yes              8465     6172314\n\n\nNo bikes can be rented on non-functioning days, so those days should be excluded from the model"
  },
  {
    "objectID": "HW8.html#data-rollup",
    "href": "HW8.html#data-rollup",
    "title": "Homework8",
    "section": "Data rollup",
    "text": "Data rollup\nProduce summarized data by:\n\ngrouping by date, seasons, and holiday\ntaking the sum of rented_bike_count, rainfall, and snowfall\ntaking the mean of temperature, humidity, wind_speed, visibility, dew_point, solar_radiation\n\n\nbike_rollup &lt;- bike_data |&gt;\n  filter(functioning_day == \"Yes\") |&gt;\n  group_by(date, seasons, holiday) |&gt;\n  summarize(across(c(rented_bike_count, rainfall, snowfall), sum),\n            across(c(temperature, humidity, wind_speed, visibility, \n                     dew_point, solar_radiation), mean))\n\n`summarise()` has grouped output by 'date', 'seasons'. You can override using\nthe `.groups` argument.\n\nbike_rollup\n\n# A tibble: 353 × 12\n# Groups:   date, seasons [353]\n   date       seasons holiday    rented_bike_count rainfall snowfall temperature\n   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;\n 1 2017-12-01 Winter  No Holiday              9539      0        0       -2.45  \n 2 2017-12-02 Winter  No Holiday              8523      0        0        1.32  \n 3 2017-12-03 Winter  No Holiday              7222      4        0        4.88  \n 4 2017-12-04 Winter  No Holiday              8729      0.1      0       -0.304 \n 5 2017-12-05 Winter  No Holiday              8307      0        0       -4.46  \n 6 2017-12-06 Winter  No Holiday              6669      1.3      8.6      0.0458\n 7 2017-12-07 Winter  No Holiday              8549      0       10.4      1.09  \n 8 2017-12-08 Winter  No Holiday              8032      0        0       -3.82  \n 9 2017-12-09 Winter  No Holiday              7233      0        0       -0.846 \n10 2017-12-10 Winter  No Holiday              3453      4.1     32.5      1.19  \n# ℹ 343 more rows\n# ℹ 5 more variables: humidity &lt;dbl&gt;, wind_speed &lt;dbl&gt;, visibility &lt;dbl&gt;,\n#   dew_point &lt;dbl&gt;, solar_radiation &lt;dbl&gt;"
  },
  {
    "objectID": "HW8.html#eda-part-2",
    "href": "HW8.html#eda-part-2",
    "title": "Homework8",
    "section": "EDA Part 2",
    "text": "EDA Part 2\nRepeat EDA for the new rollup\n\nSummary stats\n\npsych::describe(bike_rollup)\n\nWarning in FUN(newX[, i], ...): no non-missing arguments to min; returning Inf\n\n\nWarning in FUN(newX[, i], ...): no non-missing arguments to max; returning -Inf\n\n\n                  vars   n     mean      sd   median  trimmed      mad    min\ndate                 1 353      NaN      NA       NA      NaN       NA    Inf\nseasons*             2 353     2.46    1.11     2.00     2.46     1.48   1.00\nholiday*             3 353     1.95    0.21     2.00     2.00     0.00   1.00\nrented_bike_count    4 353 17485.31 9937.16 18563.00 17406.91 13811.90 977.00\nrainfall             5 353     3.58   11.79     0.00     0.62     0.00   0.00\nsnowfall             6 353     1.86    8.80     0.00     0.00     0.00   0.00\ntemperature          7 353    12.78   11.72    13.74    13.07    13.91 -14.74\nhumidity             8 353    58.17   14.87    57.17    57.68    14.89  22.25\nwind_speed           9 353     1.73    0.60     1.66     1.66     0.50   0.66\nvisibility          10 353  1434.01  491.16  1557.75  1482.65   564.44 214.29\ndew_point           11 353     3.95   12.99     4.61     4.54    14.97 -27.75\nsolar_radiation     12 353     0.57    0.32     0.56     0.56     0.41   0.03\n                       max    range  skew kurtosis     se\ndate                  -Inf     -Inf    NA       NA     NA\nseasons*              4.00     3.00  0.03    -1.34   0.06\nholiday*              2.00     1.00 -4.20    15.71   0.01\nrented_bike_count 36149.00 35172.00 -0.04    -1.41 528.90\nrainfall             95.50    95.50  4.88    26.81   0.63\nsnowfall             78.70    78.70  5.83    36.57   0.47\ntemperature          33.74    48.48 -0.21    -0.96   0.62\nhumidity             95.88    73.62  0.26    -0.34   0.79\nwind_speed            4.00     3.34  1.08     1.29   0.03\nvisibility         2000.00  1785.71 -0.62    -0.75  26.14\ndew_point            25.04    52.79 -0.30    -0.88   0.69\nsolar_radiation       1.22     1.19  0.18    -1.09   0.02\n\n\n\nNoting that the mean for rented_bike_count is now a lot higher, which is expected after removing the non-functioning days, and also after taking the sum for all hours for a specific day and then taking the average of that\n\n\nbike_data |&gt;\n  filter(functioning_day == \"Yes\") |&gt;\n  group_by(date) |&gt;\n  summarize(daily_bikes = sum(rented_bike_count)) |&gt;\n  summarize(mean(daily_bikes))\n\n# A tibble: 1 × 1\n  `mean(daily_bikes)`\n                &lt;dbl&gt;\n1              17485.\n\n\n\n\nPlots & Correlation\n\nDensity plot for daily bikes\n\ng &lt;- ggplot(bike_rollup, aes(x = rented_bike_count, fill = seasons))\ng + geom_density(alpha = 0.5)\n\n\n\n\n\n\n\n\nI expected to see fewer bikes rented per day during the winter, but the density plot shows it’s much more of a pronounced difference than I thought. Interesting that it rarely broke 10K bikes in the winter, whereas the that would be an unusually low day for summer and autumn. Also kind of interesting that the summer and spring patterns look almost bimodal, so I will be curious to see if there are correlations among the weather-related variables that may explain that.\n\n\nCorrelation\n\nbike_rollup |&gt;\n  select(where(is.numeric)) |&gt;\n  ungroup() |&gt;\n  select(-date, -seasons) |&gt;\n  cor()\n\nAdding missing grouping variables: `date`, `seasons`\n\n\n                  rented_bike_count    rainfall    snowfall  temperature\nrented_bike_count        1.00000000 -0.23910905 -0.26529110  0.753076732\nrainfall                -0.23910905  1.00000000 -0.02313404  0.144517274\nsnowfall                -0.26529110 -0.02313404  1.00000000 -0.266963662\ntemperature              0.75307673  0.14451727 -0.26696366  1.000000000\nhumidity                 0.03588697  0.52864263  0.06539191  0.404167486\nwind_speed              -0.19288142 -0.10167578  0.02088156 -0.260721792\nvisibility               0.16599375 -0.22199387 -0.10188902  0.002336683\ndew_point                0.65047655  0.26456621 -0.20955286  0.962796255\nsolar_radiation          0.73589290 -0.32270413 -0.23343056  0.550274301\n                     humidity  wind_speed   visibility  dew_point\nrented_bike_count  0.03588697 -0.19288142  0.165993749  0.6504765\nrainfall           0.52864263 -0.10167578 -0.221993866  0.2645662\nsnowfall           0.06539191  0.02088156 -0.101889019 -0.2095529\ntemperature        0.40416749 -0.26072179  0.002336683  0.9627963\nhumidity           1.00000000 -0.23425778 -0.559177334  0.6320473\nwind_speed        -0.23425778  1.00000000  0.206022636 -0.2877032\nvisibility        -0.55917733  0.20602264  1.000000000 -0.1535516\ndew_point          0.63204729 -0.28770322 -0.153551591  1.0000000\nsolar_radiation   -0.27444967  0.09612635  0.271395906  0.3831571\n                  solar_radiation\nrented_bike_count      0.73589290\nrainfall              -0.32270413\nsnowfall              -0.23343056\ntemperature            0.55027430\nhumidity              -0.27444967\nwind_speed             0.09612635\nvisibility             0.27139591\ndew_point              0.38315713\nsolar_radiation        1.00000000\n\n\nDew point, solar radiation, and temperature all seem to have a relatively strong positive correlation to bikes rented. Dew point is also very strongly correlated to temperature, so it makes sense they would both show high correlation to bikes rented (as opposed to only one of them showing a correlation). Solar radiation is interesting, because it is most highly correlated to rented bike count, and only weakly correlated to temperature, and does not show much of a linear relationship to anything else. It seems a bit odd that solar radiation would be related to the rented bike count, while simultaneously showing very little linear relationship to rainfall and snowfall, considering solar radiation may be impacted significantly by precipitation.\n\n\nScatter plots\nRunning scatter plots on the most highly correlated variables\n\ng &lt;- ggplot(bike_rollup, aes(y = rented_bike_count, x = temperature))\n\ng + geom_point(aes(color = seasons))\n\n\n\n\n\n\n\n\nKind of cool, can see clear distinctions in the rented counts vs temperature between the different seasons\n\ng &lt;- ggplot(bike_rollup, aes(y = rented_bike_count, \n                             x = solar_radiation, \n                             color = seasons))\n\ng + \n  geom_point() +\n  geom_smooth(method = \"lm\")\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nDefinitely can still see the correlation between solar radiation and bike counts, but there’s less of a clear pattern to the seasons\n\ng &lt;- ggplot(bike_rollup, aes(y = rented_bike_count, x = dew_point, color = seasons))\n\ng + \n  geom_point() + \n  geom_smooth(method = \"lm\")\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nLooks a lot like the temperature vs rented bikes scatter plot, which kind of makes sense since the dew point is so closely related to the temperature"
  },
  {
    "objectID": "HW8.html#split-the-data",
    "href": "HW8.html#split-the-data",
    "title": "Homework8",
    "section": "Split the Data",
    "text": "Split the Data\n75/25 training to test split\n\n# create the split\nbike_split &lt;- initial_split(bike_rollup, prop = 0.75, strata = seasons)\n\n# create the training and test data sets\nbike_train &lt;- training(bike_split)\nbike_test &lt;- testing(bike_split)\n\n10-fold CV split\n\n# split training set into 10 groups\nbike_10_fold &lt;- vfold_cv(bike_train, 10)"
  },
  {
    "objectID": "HW8.html#fitting-mlr-models",
    "href": "HW8.html#fitting-mlr-models",
    "title": "Homework8",
    "section": "Fitting MLR Models",
    "text": "Fitting MLR Models\n\nData Preprocessing\nCreate 3 recipes to preprocess the data for use in MLR models\nRecipe 1\n\ndefine role for date as an ID column so it’s not included in the model, but will be retained in the data set\nadd new factor that determines whether the day of the week for each date falls on the weekend or during the week\nstandardize numeric variables, except for the outcome\n\n\nbike_rec_1 &lt;- recipe(rented_bike_count ~ ., data = bike_train) |&gt;\n  update_role(date, new_role = \"ID\") |&gt;\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(part_of_week = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"),\n                                        \"Weekend\",\n                                        \"Weekday\"),\n                                levels = c(\"Weekday\", \"Weekend\"))) |&gt;\n  step_rm(date_dow) |&gt;\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_dummy(seasons, holiday, part_of_week)\n  \n\n# view data to make sure it looks okay\nbike_rec_1 |&gt;\n  prep(training = bike_train) |&gt;\n  bake(bike_train)\n\n# A tibble: 263 × 15\n   date       rainfall snowfall temperature humidity wind_speed visibility\n   &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n 1 2018-09-01   -0.315   -0.179       1.07     0.169     -0.884     0.843 \n 2 2018-09-02   -0.315   -0.179       1.03    -0.285     -0.399     1.16  \n 3 2018-09-04   -0.315   -0.179       0.884    0.878      0.689     0.0654\n 4 2018-09-05   -0.315   -0.179       0.933    0.208      1.24      1.08  \n 5 2018-09-06   -0.315   -0.179       0.968    0.821      0.244     0.430 \n 6 2018-09-07   -0.187   -0.179       0.790   -0.127      1.20      0.862 \n 7 2018-09-08   -0.315   -0.179       0.750   -0.685     -0.132     1.13  \n 8 2018-09-09   -0.315   -0.179       0.773   -0.632     -0.843     1.16  \n 9 2018-09-12   -0.315   -0.179       0.822   -0.464     -0.699     1.15  \n10 2018-09-13   -0.315   -0.179       0.900    0.242     -0.857     1.14  \n# ℹ 253 more rows\n# ℹ 8 more variables: dew_point &lt;dbl&gt;, solar_radiation &lt;dbl&gt;,\n#   rented_bike_count &lt;dbl&gt;, seasons_Spring &lt;dbl&gt;, seasons_Summer &lt;dbl&gt;,\n#   seasons_Autumn &lt;dbl&gt;, holiday_No.Holiday &lt;dbl&gt;, part_of_week_Weekend &lt;dbl&gt;\n\n\nFormula for recipe 1\n\nbike_rec_1 |&gt;\n  prep(training = bike_train) |&gt;\n  formula()\n\nrented_bike_count ~ rainfall + snowfall + temperature + humidity + \n    wind_speed + visibility + dew_point + solar_radiation + seasons_Spring + \n    seasons_Summer + seasons_Autumn + holiday_No.Holiday + part_of_week_Weekend\n&lt;environment: 0x0000019f040325a8&gt;\n\n\nRecipe 2\n\nSame transformations as recipe 1\nAdd interactions to the model formula:\n\nseasons and holiday\nseasons and temp\ntemp and rainfall\n\nOn the first pass, I did not have the step_corr in the preprocessing, but the fit_resamples() generated a warning that stated: “prediction from rank-deficient fit; consider predict(., rankdeficient=”NA”). There were issues with some computations A: x1”.\n\nFirst, I tried step_zv(), since the tidymodel tutorial had stated that if there are dummy variables with low-frequency values that don’t occur in the training data, then it’s possible for some of the downstream functions to generate warnings. That didn’t work.\nFrom other google results, I didn’t find much about the exact warning, but there was a really similar one that apparently can happen when there are variables with really high correlation. Dew point and temperature are very highly correlated, so I decided to use step_cor to address this, and it worked.\n\n\n\nbike_rec_2 &lt;- recipe(rented_bike_count ~ ., data = bike_train) |&gt;\n  update_role(date, new_role = \"ID\") |&gt;\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(part_of_week = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"),\n                                        \"Weekend\",\n                                        \"Weekday\"),\n                                levels = c(\"Weekday\", \"Weekend\"))) |&gt;\n  step_rm(date_dow) |&gt;\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_dummy(seasons, holiday, part_of_week) |&gt;\n  step_interact(terms = ~ holiday_No.Holiday : starts_with(\"seasons_\") +\n                        temperature : starts_with(\"seasons_\") + \n                        temperature : rainfall) |&gt;\n  #step_zv(all_predictors()) |&gt;\n  step_corr(all_predictors())\n  \nbike_rec_2 |&gt;\n  prep(training = bike_train) |&gt;\n  bake(bike_train)\n\n# A tibble: 263 × 17\n   date       rainfall snowfall temperature humidity wind_speed visibility\n   &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n 1 2018-09-01   -0.315   -0.179       1.07     0.169     -0.884     0.843 \n 2 2018-09-02   -0.315   -0.179       1.03    -0.285     -0.399     1.16  \n 3 2018-09-04   -0.315   -0.179       0.884    0.878      0.689     0.0654\n 4 2018-09-05   -0.315   -0.179       0.933    0.208      1.24      1.08  \n 5 2018-09-06   -0.315   -0.179       0.968    0.821      0.244     0.430 \n 6 2018-09-07   -0.187   -0.179       0.790   -0.127      1.20      0.862 \n 7 2018-09-08   -0.315   -0.179       0.750   -0.685     -0.132     1.13  \n 8 2018-09-09   -0.315   -0.179       0.773   -0.632     -0.843     1.16  \n 9 2018-09-12   -0.315   -0.179       0.822   -0.464     -0.699     1.15  \n10 2018-09-13   -0.315   -0.179       0.900    0.242     -0.857     1.14  \n# ℹ 253 more rows\n# ℹ 10 more variables: solar_radiation &lt;dbl&gt;, rented_bike_count &lt;dbl&gt;,\n#   holiday_No.Holiday &lt;dbl&gt;, part_of_week_Weekend &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Spring &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Autumn &lt;dbl&gt;,\n#   seasons_Spring_x_temperature &lt;dbl&gt;, seasons_Summer_x_temperature &lt;dbl&gt;,\n#   seasons_Autumn_x_temperature &lt;dbl&gt;, temperature_x_rainfall &lt;dbl&gt;\n\n\nFormula for recipe 2\n\nbike_rec_2 |&gt;\n  prep(training = bike_train) |&gt;\n  formula()\n\nrented_bike_count ~ rainfall + snowfall + temperature + humidity + \n    wind_speed + visibility + solar_radiation + holiday_No.Holiday + \n    part_of_week_Weekend + holiday_No.Holiday_x_seasons_Spring + \n    holiday_No.Holiday_x_seasons_Autumn + seasons_Spring_x_temperature + \n    seasons_Summer_x_temperature + seasons_Autumn_x_temperature + \n    temperature_x_rainfall\n&lt;environment: 0x0000019f0ed9a068&gt;\n\n\nRecipe 3\n\nSame transformations and interactions as recipe 2\nAdd quadratic terms for the numeric predictors\n\nNote: On the quadratic step, I initially tried to do step_poly(all_numeric_predictors()), but got an error that said “‘degree’ must be less than number of unique points”. A post on Stack Overflow states this is because there must be columns that don’t have enough unique values. Since the degree is 2, the variables included in step_poly must have at least 3 unique values. All the dummy variables had only 2 unique values. Moving step_poly before step_interact only produced more errors, so I decided to just list out the original predictor variables.\n\nbike_rec_3 &lt;- recipe(rented_bike_count ~ ., data = bike_train) |&gt;\n  update_role(date, new_role = \"ID\") |&gt;\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(part_of_week = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"),\n                                        \"Weekend\",\n                                        \"Weekday\"),\n                                levels = c(\"Weekday\", \"Weekend\"))) |&gt;\n  step_rm(date_dow) |&gt;\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_dummy(seasons, holiday, part_of_week) |&gt;\n  step_interact(terms = ~ holiday_No.Holiday : starts_with(\"seasons_\") +\n                        temperature : starts_with(\"seasons_\") + \n                        temperature : rainfall) |&gt;\n  # step_poly(all_numeric_predictors())\n  step_poly(rainfall, snowfall, temperature, humidity, wind_speed, visibility,\n            dew_point, solar_radiation) |&gt;\n  step_corr(all_predictors())\n  \nbike_rec_3 |&gt;\n  prep(training = bike_train) |&gt;\n  bake(bike_train)\n\n# A tibble: 263 × 25\n   date       rented_bike_count seasons_Spring holiday_No.Holiday\n   &lt;date&gt;                 &lt;dbl&gt;          &lt;dbl&gt;              &lt;dbl&gt;\n 1 2018-09-01             26010              0                  1\n 2 2018-09-02             26881              0                  1\n 3 2018-09-04             29529              0                  1\n 4 2018-09-05             31114              0                  1\n 5 2018-09-06             27838              0                  1\n 6 2018-09-07             30381              0                  1\n 7 2018-09-08             29813              0                  1\n 8 2018-09-09             28354              0                  1\n 9 2018-09-12             31809              0                  1\n10 2018-09-13             30991              0                  1\n# ℹ 253 more rows\n# ℹ 21 more variables: part_of_week_Weekend &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Summer &lt;dbl&gt;,\n#   holiday_No.Holiday_x_seasons_Autumn &lt;dbl&gt;,\n#   seasons_Spring_x_temperature &lt;dbl&gt;, seasons_Autumn_x_temperature &lt;dbl&gt;,\n#   temperature_x_rainfall &lt;dbl&gt;, rainfall_poly_1 &lt;dbl&gt;, rainfall_poly_2 &lt;dbl&gt;,\n#   snowfall_poly_1 &lt;dbl&gt;, snowfall_poly_2 &lt;dbl&gt;, temperature_poly_1 &lt;dbl&gt;, …\n\n\nFormula for recipe 3\n\nbike_rec_3 |&gt;\n  prep(training = bike_train) |&gt;\n  formula()\n\nrented_bike_count ~ seasons_Spring + holiday_No.Holiday + part_of_week_Weekend + \n    holiday_No.Holiday_x_seasons_Summer + holiday_No.Holiday_x_seasons_Autumn + \n    seasons_Spring_x_temperature + seasons_Autumn_x_temperature + \n    temperature_x_rainfall + rainfall_poly_1 + rainfall_poly_2 + \n    snowfall_poly_1 + snowfall_poly_2 + temperature_poly_1 + \n    temperature_poly_2 + humidity_poly_1 + humidity_poly_2 + \n    wind_speed_poly_1 + wind_speed_poly_2 + visibility_poly_1 + \n    visibility_poly_2 + dew_point_poly_2 + solar_radiation_poly_1 + \n    solar_radiation_poly_2\n&lt;environment: 0x0000019f0eb74f20&gt;\n\n\n\n\nFit the Models\nUsing a linear model\n\nbike_model &lt;- linear_reg() |&gt;\n  set_engine(\"lm\")\n\n\nWorkflows\nSet up workflows to use with 10-fold SV to fit a linear model\nRecipe 1\n\nbike_wfl_1 &lt;- workflow() |&gt;\n  add_recipe(bike_rec_1) |&gt;\n  add_model(bike_model)\n\nbike_wfl_1\n\n══ Workflow ════════════════════════════════════════════════════════════════════\nPreprocessor: Recipe\nModel: linear_reg()\n\n── Preprocessor ────────────────────────────────────────────────────────────────\n5 Recipe Steps\n\n• step_date()\n• step_mutate()\n• step_rm()\n• step_normalize()\n• step_dummy()\n\n── Model ───────────────────────────────────────────────────────────────────────\nLinear Regression Model Specification (regression)\n\nComputational engine: lm \n\n\nRecipe 2\n\nbike_wfl_2 &lt;- workflow() |&gt;\n  add_recipe(bike_rec_2) |&gt;\n  add_model(bike_model)\n\nbike_wfl_2\n\n══ Workflow ════════════════════════════════════════════════════════════════════\nPreprocessor: Recipe\nModel: linear_reg()\n\n── Preprocessor ────────────────────────────────────────────────────────────────\n7 Recipe Steps\n\n• step_date()\n• step_mutate()\n• step_rm()\n• step_normalize()\n• step_dummy()\n• step_interact()\n• step_corr()\n\n── Model ───────────────────────────────────────────────────────────────────────\nLinear Regression Model Specification (regression)\n\nComputational engine: lm \n\n\nRecipe 3\n\nbike_wfl_3 &lt;- workflow() |&gt;\n  add_recipe(bike_rec_3) |&gt;\n  add_model(bike_model)\n\nbike_wfl_3\n\n══ Workflow ════════════════════════════════════════════════════════════════════\nPreprocessor: Recipe\nModel: linear_reg()\n\n── Preprocessor ────────────────────────────────────────────────────────────────\n8 Recipe Steps\n\n• step_date()\n• step_mutate()\n• step_rm()\n• step_normalize()\n• step_dummy()\n• step_interact()\n• step_poly()\n• step_corr()\n\n── Model ───────────────────────────────────────────────────────────────────────\nLinear Regression Model Specification (regression)\n\nComputational engine: lm \n\n\n\n\nCV Fit on Model\nHave already set up the 10-fold CV split\nModel 1\n\nbike_CV_fits_1 &lt;- bike_wfl_1 |&gt;\n  fit_resamples(bike_10_fold) \n\nbike_CV_fits_1 |&gt;\n  collect_metrics()\n\n# A tibble: 2 × 6\n  .metric .estimator     mean     n  std_err .config             \n  &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;               \n1 rmse    standard   4132.       10 202.     Preprocessor1_Model1\n2 rsq     standard      0.823    10   0.0184 Preprocessor1_Model1\n\n\nModel 2\n\nbike_CV_fits_2 &lt;- bike_wfl_2 |&gt;\n  fit_resamples(bike_10_fold) \n\nbike_CV_fits_2 |&gt;\n  collect_metrics()\n\n# A tibble: 2 × 6\n  .metric .estimator     mean     n  std_err .config             \n  &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;               \n1 rmse    standard   3783.       10 143.     Preprocessor1_Model1\n2 rsq     standard      0.854    10   0.0105 Preprocessor1_Model1\n\n\nModel 3\n\nbike_CV_fits_3 &lt;- bike_wfl_3 |&gt;\n  fit_resamples(bike_10_fold) \n\nbike_CV_fits_3 |&gt;\n  collect_metrics()\n\n# A tibble: 2 × 6\n  .metric .estimator     mean     n  std_err .config             \n  &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;               \n1 rmse    standard   3517.       10 164.     Preprocessor1_Model1\n2 rsq     standard      0.871    10   0.0123 Preprocessor1_Model1"
  },
  {
    "objectID": "HW8.html#fit-on-entire-training-data",
    "href": "HW8.html#fit-on-entire-training-data",
    "title": "Homework8",
    "section": "Fit on Entire Training Data",
    "text": "Fit on Entire Training Data\nI ran the previous code multiple times, and the RMSE for each model was variable. Each of the models had the lowest RMSE at least once, but I feel that the second model seems to come in lowest pretty often, so that’s the one I went with.\nFit the best model on the entire training set:\n\nbike_wfl_2 |&gt;\n  #fit(bike_train) |&gt;\n  last_fit(bike_split) |&gt;\n  collect_metrics()\n\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config             \n  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               \n1 rmse    standard    3809.    Preprocessor1_Model1\n2 rsq     standard       0.867 Preprocessor1_Model1\n\n\nFit model on the test data\n\n# workflow for 2nd model\n#lm_fit &lt;- fit(bike_wfl_2, bike_train)\n\n# prediction for bikes rented on the test set\nbike_test_res &lt;- bike_wfl_2 |&gt;\n  fit(bike_train) |&gt;\n  predict(new_data = bike_test)\n\nbike_test_res\n\n# A tibble: 90 × 1\n   .pred\n   &lt;dbl&gt;\n 1 8023.\n 2 3000.\n 3 1608.\n 4 4448.\n 5 2922.\n 6 6865.\n 7 4588.\n 8 9390.\n 9 6153.\n10 5214.\n# ℹ 80 more rows\n\n\nCompute RMSE on the test data (confirm model error given above by last_fit)\n\n# add in the truth values\nbike_test_res &lt;- bike_test_res |&gt;\n  bind_cols(bike_test |&gt; ungroup() |&gt; select(rented_bike_count))\n\n# compare to predicted values\nbike_test_res |&gt;\n  rmse(truth = rented_bike_count, estimate = .pred)\n\n# A tibble: 1 × 3\n  .metric .estimator .estimate\n  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;\n1 rmse    standard       3809."
  },
  {
    "objectID": "HW8.html#final-model",
    "href": "HW8.html#final-model",
    "title": "Homework8",
    "section": "Final Model",
    "text": "Final Model\nFit on the entire training set, get coefficient table\n\nbike_wfl_2 |&gt;\n  #last_fit(bike_split) |&gt;\n  fit(bike_train) |&gt;\n  extract_fit_parsnip() |&gt;\n  tidy()\n\n# A tibble: 16 × 5\n   term                                estimate std.error statistic  p.value\n   &lt;chr&gt;                                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;\n 1 (Intercept)                           18816.     1101.    17.1   9.49e-44\n 2 rainfall                              -2702.      517.    -5.22  3.75e- 7\n 3 snowfall                               -343.      240.    -1.43  1.53e- 1\n 4 temperature                           10723.      949.    11.3   3.87e-24\n 5 humidity                                384.      452.     0.849 3.97e- 1\n 6 wind_speed                             -410.      255.    -1.61  1.09e- 1\n 7 visibility                              874.      322.     2.72  7.08e- 3\n 8 solar_radiation                        4064.      395.    10.3   7.32e-21\n 9 holiday_No.Holiday                     5407.     1123.     4.81  2.57e- 6\n10 part_of_week_Weekend                  -2402.      478.    -5.03  9.55e- 7\n11 holiday_No.Holiday_x_seasons_Spring   -6977.     1193.    -5.85  1.56e- 8\n12 holiday_No.Holiday_x_seasons_Autumn   -1551.     1223.    -1.27  2.06e- 1\n13 seasons_Spring_x_temperature           -932.     1276.    -0.731 4.66e- 1\n14 seasons_Summer_x_temperature         -12578.     1718.    -7.32  3.47e-12\n15 seasons_Autumn_x_temperature          -6532.     1248.    -5.23  3.54e- 7\n16 temperature_x_rainfall                  995.      581.     1.71  8.82e- 2\n\n\nReally big coefficients, which might be expected since all numeric predictors were standardized, but the outcome was not. To make sure, I am going to plot the predictions over the original data to make sure it looks okay.\nPlot predictions from the test data against the temperature values in that set, since temperature seems to be the most significant predictor\n\n# take predictions already made, and combine with temperature values\nmlm_points &lt;- bike_test_res[\".pred\"] |&gt;\n  bind_cols(bike_test |&gt; ungroup() |&gt; select(temperature))\n\n# plot original data, with the model line overlay\ng &lt;- ggplot(bike_rollup, aes(x = temperature, y = rented_bike_count)) \ng + geom_point(aes(color = seasons)) +\n  geom_smooth(data = mlm_points, aes(x = temperature, y = .pred))\n\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nHey, it looks pretty good!"
  }
]